// Generated by CoffeeScript 1.9.3
(function() {
  var Datastore, Evernote, Www, async, config, core, dataSource;

  async = require('async');

  Evernote = require('evernote').Evernote;

  Datastore = require('nedb');

  core = require('./core');

  config = require('../config');

  dataSource = require('./data-source');

  Www = (function() {
    function Www() {}


    /**
     * @public
     */

    Www.prototype.main = function(app, server) {
      core.app = app;
      core.server = server;
      core.www = this;
      core.app.locals.core = core;
      core.client = new Evernote.Client({
        token: config.developerToken,
        sandbox: config.sandbox
      });
      return async.series([
        (function(_this) {
          return function(callback) {
            var userStore;
            userStore = core.client.getUserStore();
            return userStore.getUser(function(err, user) {
              if (err) {
                return callback(err);
              }
              core.user = user;
              return callback();
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            var dbPath;
            dbPath = __dirname + '/../db/' + core.user.username + '/';
            core.db.notes = new Datastore({
              filename: dbPath + 'notes.db',
              autoload: true
            });
            core.db.timeLogs = new Datastore({
              filename: dbPath + 'time-logs.db',
              autoload: true
            });
            core.db.profitLogs = new Datastore({
              filename: dbPath + 'profit-logs.db',
              autoload: true
            });
            return callback();
          };
        })(this), (function(_this) {
          return function(callback) {
            return dataSource.reloadNotes('', function(err) {
              if (err) {
                return callback(err);
              }
              return callback();
            });
          };
        })(this)
      ], (function(_this) {
        return function(err) {
          if (err) {
            return console.error(err);
          }
          return console.log('Done');
        };
      })(this));
    };

    return Www;

  })();

  module.exports = new Www();

}).call(this);

//# sourceMappingURL=www.js.map
