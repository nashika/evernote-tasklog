// Generated by CoffeeScript 1.9.3
(function() {
  var SettingsController,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  SettingsController = (function() {
    SettingsController.prototype.lastQueryStr = null;

    function SettingsController($scope, $http, dataStore, progress) {
      this.$scope = $scope;
      this.$http = $http;
      this.dataStore = dataStore;
      this.progress = progress;
      this._onWatchPersons = bind(this._onWatchPersons, this);
      this._submit = bind(this._submit, this);
      this._add = bind(this._add, this);
      this._remove = bind(this._remove, this);
      this._down = bind(this._down, this);
      this._up = bind(this._up, this);
      this.$scope.dataStore = this.dataStore;
      this.$scope.up = this._up;
      this.$scope.down = this._down;
      this.$scope.remove = this._remove;
      this.$scope.add = this._add;
      this.$scope.submit = this._submit;
      this.$scope.$watchCollection('dataStore.persons', this._onWatchPersons);
    }

    SettingsController.prototype._up = function(index) {
      if (index === 0) {
        return;
      }
      return this.$scope.editPersons.splice(index - 1, 2, this.$scope.editPersons[index], this.$scope.editPersons[index - 1]);
    };

    SettingsController.prototype._down = function(index) {
      if (index >= this.$scope.editPersons.length - 1) {
        return;
      }
      return this.$scope.editPersons.splice(index, 2, this.$scope.editPersons[index + 1], this.$scope.editPersons[index]);
    };

    SettingsController.prototype._remove = function(index) {
      return this.$scope.editPersons.splice(index, 1);
    };

    SettingsController.prototype._add = function() {
      return this.$scope.editPersons.push("Person " + (this.$scope.editPersons.length + 1));
    };

    SettingsController.prototype._submit = function() {
      this.progress.open();
      this.progress.set('Saving persons data...', 0);
      return this.$http.put('/settings/save', {
        key: 'persons',
        data: {
          persons: this.$scope.editPersons
        }
      }).success((function(_this) {
        return function(data) {};
      })(this)).error((function(_this) {
        return function(data) {};
      })(this))["finally"]((function(_this) {
        return function() {
          _this.progress.set('Done.', 100);
          return _this.progress.close();
        };
      })(this));
    };

    SettingsController.prototype._onWatchPersons = function() {
      return this.$scope.editPersons = Object.keys(this.dataStore.persons);
    };

    return SettingsController;

  })();

  app.controller('SettingsController', ['$scope', '$http', 'dataStore', 'progress', SettingsController]);

  module.exports = SettingsController;

}).call(this);

//# sourceMappingURL=settings-controller.js.map
