(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var Controller,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Controller = (function() {
    function Controller($scope, $rootScope, $http, progress, noteFilter) {
      this.$scope = $scope;
      this.$rootScope = $rootScope;
      this.$http = $http;
      this.progress = progress;
      this.noteFilter = noteFilter;
      this.reload = bind(this.reload, this);
      this.$rootScope.user = null;
      this.$rootScope.persons = {};
      this.$rootScope.notebooks = {};
      this.$rootScope.stacks = [];
      this.$rootScope.notes = {};
      this.$rootScope.timeLogs = {};
      this.$scope.reload = this.reload;
      this.reload((function(_this) {
        return function() {};
      })(this));
    }

    Controller.prototype.reload = function(callback) {
      var noteCount, query;
      if (!callback) {
        callback = (function(_this) {
          return function() {};
        })(this);
      }
      query = this.noteFilter.query();
      noteCount = 0;
      this.progress.open();
      return async.series([
        (function(_this) {
          return function(callback) {
            if (_this.$rootScope.user) {
              return callback();
            }
            _this.progress.set('Getting user data.', 0);
            return _this.$http.get('/user').success(function(data) {
              _this.$rootScope.user = data;
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Syncing remote server.', 0);
            return _this.$http.get('/sync').success(function() {
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Getting persons data.', 10);
            return _this.$http.get('/persons').success(function(data) {
              var i, len, person;
              _this.$rootScope.persons = {};
              for (i = 0, len = data.length; i < len; i++) {
                person = data[i];
                _this.$rootScope.persons[person] = person;
              }
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Getting notebooks data.', 20);
            return _this.$http.get('/notebooks').success(function(data) {
              var i, len, notebook, stackHash;
              _this.$rootScope.notebooks = {};
              stackHash = {};
              for (i = 0, len = data.length; i < len; i++) {
                notebook = data[i];
                _this.$rootScope.notebooks[notebook.guid] = notebook;
                if (notebook.stack) {
                  stackHash[notebook.stack] = true;
                }
              }
              _this.$rootScope.stacks = Object.keys(stackHash);
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Getting notes count.', 30);
            return _this.$http.get('/notes/count', {
              params: {
                query: query
              }
            }).success(function(data) {
              noteCount = data;
              if (noteCount > 100) {
                if (window.confirm("Current query find " + noteCount + " notes. It is too many. Continue anyway?")) {
                  return callback();
                } else {
                  return callback('User Canceled');
                }
              } else {
                return callback();
              }
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Request remote contents.', 40);
            return _this.$http.get('/notes/get-content', {
              params: {
                query: query
              }
            }).success(function(data) {
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            _this.progress.set('Getting notes.', 60);
            return _this.$http.get('/notes', {
              params: {
                query: query,
                content: false
              }
            }).success(function(data) {
              var i, len, note;
              _this.$rootScope.notes = {};
              for (i = 0, len = data.length; i < len; i++) {
                note = data[i];
                _this.$rootScope.notes[note.guid] = note;
              }
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this), (function(_this) {
          return function(callback) {
            var guids, note, noteGuid;
            _this.progress.set('Getting time logs.', 80);
            guids = (function() {
              var ref, results;
              ref = this.$rootScope.notes;
              results = [];
              for (noteGuid in ref) {
                note = ref[noteGuid];
                results.push(note.guid);
              }
              return results;
            }).call(_this);
            return _this.$http.post('/time-logs', {
              query: {
                noteGuid: {
                  $in: guids
                }
              },
              limit: 300
            }).success(function(data) {
              var base, i, len, name, timeLog;
              _this.$rootScope.timeLogs = {};
              for (i = 0, len = data.length; i < len; i++) {
                timeLog = data[i];
                if ((base = _this.$rootScope.timeLogs)[name = timeLog.noteGuid] == null) {
                  base[name] = {};
                }
                _this.$rootScope.timeLogs[timeLog.noteGuid][timeLog._id] = timeLog;
              }
              return callback();
            }).error(function(data) {
              return callback(data);
            });
          };
        })(this)
      ], (function(_this) {
        return function(err) {
          _this.progress.set('Done.', 100);
          _this.progress.close();
          if (err) {
            throw new Error(err);
          }
          return callback(err);
        };
      })(this));
    };

    return Controller;

  })();

  app.controller('Controller', ['$scope', '$rootScope', '$http', 'progress', 'noteFilter', Controller]);

  module.exports = Controller;

}).call(this);



},{}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var ModalController;

  ModalController = (function() {
    function ModalController($scope) {
      this.$scope = $scope;
    }

    return ModalController;

  })();

  app.controller('ModalController', ['$scope', ModalController]);

  module.exports = ModalController;

}).call(this);



},{}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var NavigationController;

  NavigationController = (function() {
    function NavigationController($scope, $route) {
      this.$scope = $scope;
      this.$route = $route;
      this.$scope.navCollapse = true;
      this.$scope.$route = this.$route;
    }

    return NavigationController;

  })();

  app.controller('NavigationController', ['$scope', '$route', NavigationController]);

  module.exports = NavigationController;

}).call(this);



},{}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var NotesController,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  NotesController = (function() {
    function NotesController($scope) {
      this.$scope = $scope;
      this._onWatchTimeLogs = bind(this._onWatchTimeLogs, this);
      this._getSpentTime = bind(this._getSpentTime, this);
      this.$scope.noteSpentTimes = {};
      this.$scope.getSpentTime = this._getSpentTime;
      this.$scope.$watchCollection('timeLogs', this._onWatchTimeLogs);
    }

    NotesController.prototype._getSpentTime = function(noteGuid) {
      var hour, minute;
      if (!this.$scope.noteSpentTimes[noteGuid]) {
        return '0m';
      }
      hour = Math.floor(this.$scope.noteSpentTimes[noteGuid] / 60);
      minute = this.$scope.noteSpentTimes[noteGuid] % 60;
      if (hour) {
        return hour + 'h' + minute + 'm';
      }
      return minute + 'm';
    };

    NotesController.prototype._onWatchTimeLogs = function(timeLogs) {
      var name, noteGuid, noteSpentTimes, noteTimeLog, timeLog, timeLog_id;
      noteSpentTimes = {};
      for (noteGuid in timeLogs) {
        noteTimeLog = timeLogs[noteGuid];
        for (timeLog_id in noteTimeLog) {
          timeLog = noteTimeLog[timeLog_id];
          if (noteSpentTimes[name = timeLog.noteGuid] == null) {
            noteSpentTimes[name] = 0;
          }
          noteSpentTimes[timeLog.noteGuid] += timeLog.spentTime;
        }
      }
      return this.$scope.noteSpentTimes = noteSpentTimes;
    };

    return NotesController;

  })();

  app.controller('NotesController', ['$scope', NotesController]);

  module.exports = NotesController;

}).call(this);



},{}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var ModalController, ProgressModalController,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  ModalController = require('./modal-controller');

  ProgressModalController = (function(superClass) {
    extend(ProgressModalController, superClass);

    function ProgressModalController($scope, progress) {
      this.$scope = $scope;
      this.progress = progress;
      this.$scope.progress = this.progress;
    }

    return ProgressModalController;

  })(ModalController);

  app.controller('ProgressModalController', ['$scope', 'progress', ProgressModalController]);

  module.exports = ProgressModalController;

}).call(this);



},{"./modal-controller":2}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var SettingsController,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  SettingsController = (function() {
    SettingsController.prototype.lastQueryStr = null;

    function SettingsController($scope, $http, noteFilter) {
      this.$scope = $scope;
      this.$http = $http;
      this.noteFilter = noteFilter;
      this._onWatchNoteFilter = bind(this._onWatchNoteFilter, this);
      this.$scope.noteFilter = this.noteFilter;
      this.$scope.$watchGroup(['noteFilter.updated', 'noteFilter.notebooks', 'noteFilter.stacks'], this._onWatchNoteFilter);
    }

    SettingsController.prototype._onWatchNoteFilter = function() {
      var query, queryStr;
      query = this.noteFilter.query();
      queryStr = JSON.stringify(query);
      if (this.lastQueryStr === queryStr) {
        return;
      }
      this.lastQueryStr = queryStr;
      return this.$http.get('/notes/count', {
        params: {
          query: query
        }
      }).success((function(_this) {
        return function(data) {
          return _this.noteFilter.count = data;
        };
      })(this)).error((function(_this) {
        return function(data) {
          return _this.noteFilter.count = null;
        };
      })(this));
    };

    return SettingsController;

  })();

  app.controller('SettingsController', ['$scope', '$http', 'noteFilter', SettingsController]);

  module.exports = SettingsController;

}).call(this);



},{}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var TimelineController,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  TimelineController = (function() {
    function TimelineController($scope) {
      var container, options;
      this.$scope = $scope;
      this._onResize = bind(this._onResize, this);
      this._onWatchProfitLogs = bind(this._onWatchProfitLogs, this);
      this._onWatchNotes = bind(this._onWatchNotes, this);
      this._onWatchPersons = bind(this._onWatchPersons, this);
      this.$scope.timelineItems = new vis.DataSet();
      this.$scope.timelineGroups = new vis.DataSet();
      container = document.getElementById('timeline');
      options = {
        margin: {
          item: 5
        },
        height: window.innerHeight - 80,
        orientation: {
          axis: 'both',
          item: 'top'
        },
        start: moment().startOf('day'),
        end: moment().endOf('day'),
        hiddenDates: [
          {
            start: moment().subtract(1, 'days').startOf('day').hour(20),
            end: moment().startOf('day').hour(8),
            repeat: 'daily'
          }
        ],
        order: function(a, b) {
          return a.start - b.start;
        }
      };
      this.$scope.timeline = new vis.Timeline(container, this.$scope.timelineItems, this.$scope.timelineGroups, options);
      this.$scope.$watchCollection('persons', this._onWatchPersons);
      this.$scope.$watchCollection('notes', this._onWatchNotes);
      this.$scope.$watchCollection('timeLogs', this._onWatchNotes);
      this.$scope.$watchCollection('profitLogs', this._onWatchProfitLogs);
      this.$scope.$on('resize::resize', this._onResize);
    }

    TimelineController.prototype._onWatchPersons = function() {
      var key, person, ref;
      this.$scope.timelineGroups.clear();
      ref = this.$scope.persons;
      for (key in ref) {
        person = ref[key];
        this.$scope.timelineGroups.add({
          id: key,
          content: person
        });
      }
      return this.$scope.timelineGroups.add({
        id: 'updated',
        content: 'Update'
      });
    };

    TimelineController.prototype._onWatchNotes = function() {
      var end, note, noteGuid, noteTimeLog, ref, ref1, results, start, timeLog, timeLogs_id;
      this.$scope.timelineItems.clear();
      ref = this.$scope.notes;
      for (noteGuid in ref) {
        note = ref[noteGuid];
        this.$scope.timelineItems.add({
          id: note.guid,
          group: 'updated',
          content: "<a href=\"evernote:///view/" + this.$scope.user.id + "/" + this.$scope.user.shardId + "/" + note.guid + "/" + note.guid + "/\">" + note.title + "</a>",
          start: new Date(note.updated),
          type: 'point'
        });
      }
      ref1 = this.$scope.timeLogs;
      results = [];
      for (noteGuid in ref1) {
        noteTimeLog = ref1[noteGuid];
        results.push((function() {
          var results1;
          results1 = [];
          for (timeLogs_id in noteTimeLog) {
            timeLog = noteTimeLog[timeLogs_id];
            start = new Date(timeLog.date);
            if (timeLog.spentTime) {
              end = new Date(start);
              end.setMinutes(start.getMinutes() + timeLog.spentTime);
            } else {
              end = null;
            }
            results1.push(this.$scope.timelineItems.add({
              id: timeLog._id,
              group: timeLog.person,
              content: "<a href=\"evernote:///view/" + this.$scope.user.id + "/" + this.$scope.user.shardId + "/" + timeLog.noteGuid + "/" + timeLog.noteGuid + "/\">" + this.$scope.notes[timeLog.noteGuid].title + " " + timeLog.comment + "</a>",
              start: start,
              end: end,
              type: end ? 'range' : 'point'
            }));
          }
          return results1;
        }).call(this));
      }
      return results;
    };

    TimelineController.prototype._onWatchProfitLogs = function() {};

    TimelineController.prototype._onResize = function(event) {
      return this.$scope.timeline.setOptions({
        height: window.innerHeight - 90
      });
    };

    return TimelineController;

  })();

  app.controller('TimelineController', ['$scope', TimelineController]);

  module.exports = TimelineController;

}).call(this);



},{}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  app.directive('resize', function($timeout, $rootScope, $window) {
    return {
      link: function() {
        var timer;
        timer = false;
        return angular.element($window).on('load resize', function(event) {
          if (timer) {
            $timeout.cancel(timer);
          }
          return timer = $timeout(function() {
            return $rootScope.$broadcast('resize::resize');
          }, 200);
        });
      }
    };
  });

}).call(this);



},{}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var checkItemMatches, filterByProperty;

  checkItemMatches = (function(_this) {
    return function(item, props) {
      var itemMatches, prop, text;
      itemMatches = false;
      for (prop in props) {
        text = props[prop];
        text = text.toLowerCase();
        if (item[prop].toString().toLowerCase().indexOf(text) !== -1) {
          itemMatches = true;
          break;
        }
      }
      return itemMatches;
    };
  })(this);

  filterByProperty = function() {
    return function(items, props) {
      var i, item, itemMatches, key, len, out;
      out = [];
      if (angular.isArray(items)) {
        for (i = 0, len = items.length; i < len; i++) {
          item = items[i];
          itemMatches = checkItemMatches(item, props);
          if (itemMatches) {
            out.push(item);
          }
        }
      } else if (angular.isObject(items)) {
        for (key in items) {
          item = items[key];
          itemMatches = checkItemMatches(item, props);
          if (itemMatches) {
            out.push(item);
          }
        }
      } else {
        out = items;
      }
      return out;
    };
  };

  app.filter('filterByProperty', filterByProperty);

  module.exports = filterByProperty;

}).call(this);



},{}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var orderObjectBy;

  orderObjectBy = function() {
    return function(items, field, reverse) {
      var filtered, results;
      if (field == null) {
        field = '$value';
      }
      if (reverse == null) {
        reverse = true;
      }
      filtered = [];
      angular.forEach(items, function(item, key) {
        return filtered.push({
          key: key,
          item: item
        });
      });
      filtered.sort(function(a, b) {
        if (field === '$key') {
          if (a.key > b.key) {
            return -1;
          } else {
            return 1;
          }
        }
        if (field === '$value') {
          if (a.item > b.item) {
            return -1;
          } else {
            return 1;
          }
        }
        if (typeof field === 'string') {
          if (a[field] > b[field]) {
            return -1;
          } else {
            return 1;
          }
        }
        if (typeof field === 'function') {
          if (field(a.item, a.key) > field(b.item, b.key)) {
            return -1;
          } else {
            return 1;
          }
        }
      });
      if (reverse) {
        filtered.reverse();
      }
      results = [];
      angular.forEach(filtered, function(item) {
        var result;
        result = item.item;
        result['$key'] = item.key;
        return results.push(result);
      });
      return results;
    };
  };

  app.filter('orderObjectBy', orderObjectBy);

  module.exports = orderObjectBy;

}).call(this);



},{}],11:[function(require,module,exports){
window.app = angular.module('App', ['ngRoute', 'ui.bootstrap', 'ngSanitize', 'ui.select']);

app.config([
  '$compileProvider', function($compileProvider) {
    return $compileProvider.aHrefSanitizationWhitelist(/^\s*(http|https|mailto|evernote):/);
  }
]);

require('./route');

require('./filters/filter-by-property');

require('./filters/order-object-by');

require('./services/note-filter');

require('./services/progress');

require('./directives/resize');

require('./controllers/controller');

require('./controllers/navigation-controller');

require('./controllers/timeline-controller');

require('./controllers/notes-controller');

require('./controllers/settings-controller');

require('./controllers/progress-modal-controller');


},{"./controllers/controller":1,"./controllers/navigation-controller":3,"./controllers/notes-controller":4,"./controllers/progress-modal-controller":5,"./controllers/settings-controller":6,"./controllers/timeline-controller":7,"./directives/resize":8,"./filters/filter-by-property":9,"./filters/order-object-by":10,"./route":12,"./services/note-filter":13,"./services/progress":14}],12:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  app.config([
    '$routeProvider', function($routeProvider) {
      return $routeProvider.when('/', {
        redirectTo: '/timeline'
      }).when('/timeline', {
        templateUrl: 'timeline'
      }).when('/notes', {
        templateUrl: 'notes'
      }).when('/settings', {
        templateUrl: 'settings'
      }).otherwise({
        redirectTo: '/'
      });
    }
  ]);

}).call(this);



},{}],13:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var NoteFilterService,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  NoteFilterService = (function() {
    NoteFilterService.prototype.updated = 3;

    NoteFilterService.prototype.notebooks = null;

    NoteFilterService.prototype.stacks = null;

    NoteFilterService.prototype.count = null;

    function NoteFilterService($rootScope) {
      this.$rootScope = $rootScope;
      this.query = bind(this.query, this);
    }

    NoteFilterService.prototype.query = function() {
      var i, j, len, len1, notebook, notebookGuid, notebooksArray, notebooksHash, ref, ref1, ref2, result, stack;
      result = {};
      if (this.updated) {
        merge(result, {
          updated: {
            $gte: parseInt(moment().startOf('day').subtract(this.updated, 'days').format('x'))
          }
        });
      }
      notebooksHash = {};
      if (this.notebooks && this.notebooks.length > 0) {
        ref = this.notebooks;
        for (i = 0, len = ref.length; i < len; i++) {
          notebookGuid = ref[i];
          notebooksHash[notebookGuid] = true;
        }
      }
      if (this.stacks && this.stacks.length > 0) {
        ref1 = this.stacks;
        for (j = 0, len1 = ref1.length; j < len1; j++) {
          stack = ref1[j];
          ref2 = this.$rootScope.notebooks;
          for (notebookGuid in ref2) {
            notebook = ref2[notebookGuid];
            if (stack === notebook.stack) {
              notebooksHash[notebook.guid] = true;
            }
          }
        }
      }
      notebooksArray = Object.keys(notebooksHash);
      if (notebooksArray.length > 0) {
        merge(result, {
          notebookGuid: {
            $in: notebooksArray
          }
        });
      }
      return result;
    };

    return NoteFilterService;

  })();

  app.service('noteFilter', ['$rootScope', NoteFilterService]);

  module.exports = NoteFilterService;

}).call(this);



},{}],14:[function(require,module,exports){
// Generated by CoffeeScript 1.9.3
(function() {
  var ProgressService,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  ProgressService = (function() {
    ProgressService.prototype.modalInstance = null;

    ProgressService.prototype.value = 0;

    ProgressService.prototype.message = '';

    function ProgressService($modal) {
      this.$modal = $modal;
      this.set = bind(this.set, this);
      this.close = bind(this.close, this);
      this.open = bind(this.open, this);
    }

    ProgressService.prototype.open = function() {
      this.message = 'processing...';
      this.value = 0;
      return this.modalInstance = this.$modal.open({
        templateUrl: 'progress-modal',
        controller: 'ProgressModalController',
        backdrop: 'static',
        keyboard: false,
        size: 'sm',
        animation: false
      });
    };

    ProgressService.prototype.close = function() {
      return this.modalInstance.close();
    };

    ProgressService.prototype.set = function(message, value) {
      if (value == null) {
        value = null;
      }
      this.message = message;
      if (value !== null) {
        return this.value = value;
      }
    };

    return ProgressService;

  })();

  app.service('progress', ['$modal', ProgressService]);

  module.exports = ProgressService;

}).call(this);



},{}]},{},[11])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29udHJvbGxlcnMvY29udHJvbGxlci5qcyIsInNyYy9jb250cm9sbGVycy9tb2RhbC1jb250cm9sbGVyLmpzIiwic3JjL2NvbnRyb2xsZXJzL25hdmlnYXRpb24tY29udHJvbGxlci5qcyIsInNyYy9jb250cm9sbGVycy9ub3Rlcy1jb250cm9sbGVyLmpzIiwic3JjL2NvbnRyb2xsZXJzL3Byb2dyZXNzLW1vZGFsLWNvbnRyb2xsZXIuanMiLCJzcmMvY29udHJvbGxlcnMvc2V0dGluZ3MtY29udHJvbGxlci5qcyIsInNyYy9jb250cm9sbGVycy90aW1lbGluZS1jb250cm9sbGVyLmpzIiwic3JjL2RpcmVjdGl2ZXMvcmVzaXplLmpzIiwic3JjL2ZpbHRlcnMvZmlsdGVyLWJ5LXByb3BlcnR5LmpzIiwic3JjL2ZpbHRlcnMvb3JkZXItb2JqZWN0LWJ5LmpzIiwiQzpcXFVzZXJzXFxoaWdhc2hpbmFrYXRzdVxcRG9jdW1lbnRzXFx3b3Jrc3BhY2VcXGV2ZXJub3RlLXRhc2tsb2dcXHB1YmxpY1xcamF2YXNjcmlwdHNcXHNyY1xcaW5kZXguY29mZmVlIiwic3JjL3JvdXRlLmpzIiwic3JjL3NlcnZpY2VzL25vdGUtZmlsdGVyLmpzIiwic3JjL3NlcnZpY2VzL3Byb2dyZXNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQy9IQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RFQSxNQUFNLENBQUMsR0FBUCxHQUFhLE9BQU8sQ0FBQyxNQUFSLENBQWUsS0FBZixFQUFzQixDQUFDLFNBQUQsRUFBWSxjQUFaLEVBQTRCLFlBQTVCLEVBQTBDLFdBQTFDLENBQXRCOztBQUViLEdBQUcsQ0FBQyxNQUFKLENBQVc7RUFBQyxrQkFBRCxFQUFxQixTQUFDLGdCQUFEO1dBQzlCLGdCQUFnQixDQUFDLDBCQUFqQixDQUE0QyxtQ0FBNUM7RUFEOEIsQ0FBckI7Q0FBWDs7QUFLQSxPQUFBLENBQVEsU0FBUjs7QUFHQSxPQUFBLENBQVEsOEJBQVI7O0FBQ0EsT0FBQSxDQUFRLDJCQUFSOztBQUdBLE9BQUEsQ0FBUSx3QkFBUjs7QUFDQSxPQUFBLENBQVEscUJBQVI7O0FBR0EsT0FBQSxDQUFRLHFCQUFSOztBQUdBLE9BQUEsQ0FBUSwwQkFBUjs7QUFDQSxPQUFBLENBQVEscUNBQVI7O0FBQ0EsT0FBQSxDQUFRLG1DQUFSOztBQUNBLE9BQUEsQ0FBUSxnQ0FBUjs7QUFDQSxPQUFBLENBQVEsbUNBQVI7O0FBQ0EsT0FBQSxDQUFRLHlDQUFSOzs7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgQ29udHJvbGxlcixcbiAgICBiaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfTtcblxuICBDb250cm9sbGVyID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgcHJvZ3Jlc3MsIG5vdGVGaWx0ZXIpIHtcbiAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgdGhpcy4kcm9vdFNjb3BlID0gJHJvb3RTY29wZTtcbiAgICAgIHRoaXMuJGh0dHAgPSAkaHR0cDtcbiAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgIHRoaXMubm90ZUZpbHRlciA9IG5vdGVGaWx0ZXI7XG4gICAgICB0aGlzLnJlbG9hZCA9IGJpbmQodGhpcy5yZWxvYWQsIHRoaXMpO1xuICAgICAgdGhpcy4kcm9vdFNjb3BlLnVzZXIgPSBudWxsO1xuICAgICAgdGhpcy4kcm9vdFNjb3BlLnBlcnNvbnMgPSB7fTtcbiAgICAgIHRoaXMuJHJvb3RTY29wZS5ub3RlYm9va3MgPSB7fTtcbiAgICAgIHRoaXMuJHJvb3RTY29wZS5zdGFja3MgPSBbXTtcbiAgICAgIHRoaXMuJHJvb3RTY29wZS5ub3RlcyA9IHt9O1xuICAgICAgdGhpcy4kcm9vdFNjb3BlLnRpbWVMb2dzID0ge307XG4gICAgICB0aGlzLiRzY29wZS5yZWxvYWQgPSB0aGlzLnJlbG9hZDtcbiAgICAgIHRoaXMucmVsb2FkKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7fTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9XG5cbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5yZWxvYWQgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgdmFyIG5vdGVDb3VudCwgcXVlcnk7XG4gICAgICBpZiAoIWNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrID0gKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge307XG4gICAgICAgIH0pKHRoaXMpO1xuICAgICAgfVxuICAgICAgcXVlcnkgPSB0aGlzLm5vdGVGaWx0ZXIucXVlcnkoKTtcbiAgICAgIG5vdGVDb3VudCA9IDA7XG4gICAgICB0aGlzLnByb2dyZXNzLm9wZW4oKTtcbiAgICAgIHJldHVybiBhc3luYy5zZXJpZXMoW1xuICAgICAgICAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy4kcm9vdFNjb3BlLnVzZXIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5wcm9ncmVzcy5zZXQoJ0dldHRpbmcgdXNlciBkYXRhLicsIDApO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLiRodHRwLmdldCgnL3VzZXInKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgX3RoaXMuJHJvb3RTY29wZS51c2VyID0gZGF0YTtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIF90aGlzLnByb2dyZXNzLnNldCgnU3luY2luZyByZW1vdGUgc2VydmVyLicsIDApO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLiRodHRwLmdldCgnL3N5bmMnKS5zdWNjZXNzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgX3RoaXMucHJvZ3Jlc3Muc2V0KCdHZXR0aW5nIHBlcnNvbnMgZGF0YS4nLCAxMCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJGh0dHAuZ2V0KCcvcGVyc29ucycpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICB2YXIgaSwgbGVuLCBwZXJzb247XG4gICAgICAgICAgICAgIF90aGlzLiRyb290U2NvcGUucGVyc29ucyA9IHt9O1xuICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgcGVyc29uID0gZGF0YVtpXTtcbiAgICAgICAgICAgICAgICBfdGhpcy4kcm9vdFNjb3BlLnBlcnNvbnNbcGVyc29uXSA9IHBlcnNvbjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgX3RoaXMucHJvZ3Jlc3Muc2V0KCdHZXR0aW5nIG5vdGVib29rcyBkYXRhLicsIDIwKTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy4kaHR0cC5nZXQoJy9ub3RlYm9va3MnKS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgdmFyIGksIGxlbiwgbm90ZWJvb2ssIHN0YWNrSGFzaDtcbiAgICAgICAgICAgICAgX3RoaXMuJHJvb3RTY29wZS5ub3RlYm9va3MgPSB7fTtcbiAgICAgICAgICAgICAgc3RhY2tIYXNoID0ge307XG4gICAgICAgICAgICAgIGZvciAoaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBub3RlYm9vayA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgX3RoaXMuJHJvb3RTY29wZS5ub3RlYm9va3Nbbm90ZWJvb2suZ3VpZF0gPSBub3RlYm9vaztcbiAgICAgICAgICAgICAgICBpZiAobm90ZWJvb2suc3RhY2spIHtcbiAgICAgICAgICAgICAgICAgIHN0YWNrSGFzaFtub3RlYm9vay5zdGFja10gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBfdGhpcy4kcm9vdFNjb3BlLnN0YWNrcyA9IE9iamVjdC5rZXlzKHN0YWNrSGFzaCk7XG4gICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSwgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBfdGhpcy5wcm9ncmVzcy5zZXQoJ0dldHRpbmcgbm90ZXMgY291bnQuJywgMzApO1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLiRodHRwLmdldCgnL25vdGVzL2NvdW50Jywge1xuICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBxdWVyeTogcXVlcnlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIG5vdGVDb3VudCA9IGRhdGE7XG4gICAgICAgICAgICAgIGlmIChub3RlQ291bnQgPiAxMDApIHtcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LmNvbmZpcm0oXCJDdXJyZW50IHF1ZXJ5IGZpbmQgXCIgKyBub3RlQ291bnQgKyBcIiBub3Rlcy4gSXQgaXMgdG9vIG1hbnkuIENvbnRpbnVlIGFueXdheT9cIikpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soJ1VzZXIgQ2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgX3RoaXMucHJvZ3Jlc3Muc2V0KCdSZXF1ZXN0IHJlbW90ZSBjb250ZW50cy4nLCA0MCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJGh0dHAuZ2V0KCcvbm90ZXMvZ2V0LWNvbnRlbnQnLCB7XG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIF90aGlzLnByb2dyZXNzLnNldCgnR2V0dGluZyBub3Rlcy4nLCA2MCk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJGh0dHAuZ2V0KCcvbm90ZXMnLCB7XG4gICAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcbiAgICAgICAgICAgICAgICBjb250ZW50OiBmYWxzZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgdmFyIGksIGxlbiwgbm90ZTtcbiAgICAgICAgICAgICAgX3RoaXMuJHJvb3RTY29wZS5ub3RlcyA9IHt9O1xuICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbm90ZSA9IGRhdGFbaV07XG4gICAgICAgICAgICAgICAgX3RoaXMuJHJvb3RTY29wZS5ub3Rlc1tub3RlLmd1aWRdID0gbm90ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyIGd1aWRzLCBub3RlLCBub3RlR3VpZDtcbiAgICAgICAgICAgIF90aGlzLnByb2dyZXNzLnNldCgnR2V0dGluZyB0aW1lIGxvZ3MuJywgODApO1xuICAgICAgICAgICAgZ3VpZHMgPSAoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhciByZWYsIHJlc3VsdHM7XG4gICAgICAgICAgICAgIHJlZiA9IHRoaXMuJHJvb3RTY29wZS5ub3RlcztcbiAgICAgICAgICAgICAgcmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICBmb3IgKG5vdGVHdWlkIGluIHJlZikge1xuICAgICAgICAgICAgICAgIG5vdGUgPSByZWZbbm90ZUd1aWRdO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChub3RlLmd1aWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgICAgfSkuY2FsbChfdGhpcyk7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJGh0dHAucG9zdCgnL3RpbWUtbG9ncycsIHtcbiAgICAgICAgICAgICAgcXVlcnk6IHtcbiAgICAgICAgICAgICAgICBub3RlR3VpZDoge1xuICAgICAgICAgICAgICAgICAgJGluOiBndWlkc1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGltaXQ6IDMwMFxuICAgICAgICAgICAgfSkuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgIHZhciBiYXNlLCBpLCBsZW4sIG5hbWUsIHRpbWVMb2c7XG4gICAgICAgICAgICAgIF90aGlzLiRyb290U2NvcGUudGltZUxvZ3MgPSB7fTtcbiAgICAgICAgICAgICAgZm9yIChpID0gMCwgbGVuID0gZGF0YS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIHRpbWVMb2cgPSBkYXRhW2ldO1xuICAgICAgICAgICAgICAgIGlmICgoYmFzZSA9IF90aGlzLiRyb290U2NvcGUudGltZUxvZ3MpW25hbWUgPSB0aW1lTG9nLm5vdGVHdWlkXSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICBiYXNlW25hbWVdID0ge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLiRyb290U2NvcGUudGltZUxvZ3NbdGltZUxvZy5ub3RlR3VpZF1bdGltZUxvZy5faWRdID0gdGltZUxvZztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcylcbiAgICAgIF0sIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgX3RoaXMucHJvZ3Jlc3Muc2V0KCdEb25lLicsIDEwMCk7XG4gICAgICAgICAgX3RoaXMucHJvZ3Jlc3MuY2xvc2UoKTtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycik7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb250cm9sbGVyO1xuXG4gIH0pKCk7XG5cbiAgYXBwLmNvbnRyb2xsZXIoJ0NvbnRyb2xsZXInLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRodHRwJywgJ3Byb2dyZXNzJywgJ25vdGVGaWx0ZXInLCBDb250cm9sbGVyXSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBDb250cm9sbGVyO1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jb250cm9sbGVyLmpzLm1hcFxuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgTW9kYWxDb250cm9sbGVyO1xuXG4gIE1vZGFsQ29udHJvbGxlciA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBNb2RhbENvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICB9XG5cbiAgICByZXR1cm4gTW9kYWxDb250cm9sbGVyO1xuXG4gIH0pKCk7XG5cbiAgYXBwLmNvbnRyb2xsZXIoJ01vZGFsQ29udHJvbGxlcicsIFsnJHNjb3BlJywgTW9kYWxDb250cm9sbGVyXSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBNb2RhbENvbnRyb2xsZXI7XG5cbn0pLmNhbGwodGhpcyk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW1vZGFsLWNvbnRyb2xsZXIuanMubWFwXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4zXHJcbihmdW5jdGlvbigpIHtcclxuICB2YXIgTmF2aWdhdGlvbkNvbnRyb2xsZXI7XHJcblxyXG4gIE5hdmlnYXRpb25Db250cm9sbGVyID0gKGZ1bmN0aW9uKCkge1xyXG4gICAgZnVuY3Rpb24gTmF2aWdhdGlvbkNvbnRyb2xsZXIoJHNjb3BlLCAkcm91dGUpIHtcclxuICAgICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XHJcbiAgICAgIHRoaXMuJHJvdXRlID0gJHJvdXRlO1xyXG4gICAgICB0aGlzLiRzY29wZS5uYXZDb2xsYXBzZSA9IHRydWU7XHJcbiAgICAgIHRoaXMuJHNjb3BlLiRyb3V0ZSA9IHRoaXMuJHJvdXRlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBOYXZpZ2F0aW9uQ29udHJvbGxlcjtcclxuXHJcbiAgfSkoKTtcclxuXHJcbiAgYXBwLmNvbnRyb2xsZXIoJ05hdmlnYXRpb25Db250cm9sbGVyJywgWyckc2NvcGUnLCAnJHJvdXRlJywgTmF2aWdhdGlvbkNvbnRyb2xsZXJdKTtcclxuXHJcbiAgbW9kdWxlLmV4cG9ydHMgPSBOYXZpZ2F0aW9uQ29udHJvbGxlcjtcclxuXHJcbn0pLmNhbGwodGhpcyk7XHJcblxyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1uYXZpZ2F0aW9uLWNvbnRyb2xsZXIuanMubWFwXHJcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjNcbihmdW5jdGlvbigpIHtcbiAgdmFyIE5vdGVzQ29udHJvbGxlcixcbiAgICBiaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfTtcblxuICBOb3Rlc0NvbnRyb2xsZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gTm90ZXNDb250cm9sbGVyKCRzY29wZSkge1xuICAgICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgICB0aGlzLl9vbldhdGNoVGltZUxvZ3MgPSBiaW5kKHRoaXMuX29uV2F0Y2hUaW1lTG9ncywgdGhpcyk7XG4gICAgICB0aGlzLl9nZXRTcGVudFRpbWUgPSBiaW5kKHRoaXMuX2dldFNwZW50VGltZSwgdGhpcyk7XG4gICAgICB0aGlzLiRzY29wZS5ub3RlU3BlbnRUaW1lcyA9IHt9O1xuICAgICAgdGhpcy4kc2NvcGUuZ2V0U3BlbnRUaW1lID0gdGhpcy5fZ2V0U3BlbnRUaW1lO1xuICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndGltZUxvZ3MnLCB0aGlzLl9vbldhdGNoVGltZUxvZ3MpO1xuICAgIH1cblxuICAgIE5vdGVzQ29udHJvbGxlci5wcm90b3R5cGUuX2dldFNwZW50VGltZSA9IGZ1bmN0aW9uKG5vdGVHdWlkKSB7XG4gICAgICB2YXIgaG91ciwgbWludXRlO1xuICAgICAgaWYgKCF0aGlzLiRzY29wZS5ub3RlU3BlbnRUaW1lc1tub3RlR3VpZF0pIHtcbiAgICAgICAgcmV0dXJuICcwbSc7XG4gICAgICB9XG4gICAgICBob3VyID0gTWF0aC5mbG9vcih0aGlzLiRzY29wZS5ub3RlU3BlbnRUaW1lc1tub3RlR3VpZF0gLyA2MCk7XG4gICAgICBtaW51dGUgPSB0aGlzLiRzY29wZS5ub3RlU3BlbnRUaW1lc1tub3RlR3VpZF0gJSA2MDtcbiAgICAgIGlmIChob3VyKSB7XG4gICAgICAgIHJldHVybiBob3VyICsgJ2gnICsgbWludXRlICsgJ20nO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1pbnV0ZSArICdtJztcbiAgICB9O1xuXG4gICAgTm90ZXNDb250cm9sbGVyLnByb3RvdHlwZS5fb25XYXRjaFRpbWVMb2dzID0gZnVuY3Rpb24odGltZUxvZ3MpIHtcbiAgICAgIHZhciBuYW1lLCBub3RlR3VpZCwgbm90ZVNwZW50VGltZXMsIG5vdGVUaW1lTG9nLCB0aW1lTG9nLCB0aW1lTG9nX2lkO1xuICAgICAgbm90ZVNwZW50VGltZXMgPSB7fTtcbiAgICAgIGZvciAobm90ZUd1aWQgaW4gdGltZUxvZ3MpIHtcbiAgICAgICAgbm90ZVRpbWVMb2cgPSB0aW1lTG9nc1tub3RlR3VpZF07XG4gICAgICAgIGZvciAodGltZUxvZ19pZCBpbiBub3RlVGltZUxvZykge1xuICAgICAgICAgIHRpbWVMb2cgPSBub3RlVGltZUxvZ1t0aW1lTG9nX2lkXTtcbiAgICAgICAgICBpZiAobm90ZVNwZW50VGltZXNbbmFtZSA9IHRpbWVMb2cubm90ZUd1aWRdID09IG51bGwpIHtcbiAgICAgICAgICAgIG5vdGVTcGVudFRpbWVzW25hbWVdID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgbm90ZVNwZW50VGltZXNbdGltZUxvZy5ub3RlR3VpZF0gKz0gdGltZUxvZy5zcGVudFRpbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLiRzY29wZS5ub3RlU3BlbnRUaW1lcyA9IG5vdGVTcGVudFRpbWVzO1xuICAgIH07XG5cbiAgICByZXR1cm4gTm90ZXNDb250cm9sbGVyO1xuXG4gIH0pKCk7XG5cbiAgYXBwLmNvbnRyb2xsZXIoJ05vdGVzQ29udHJvbGxlcicsIFsnJHNjb3BlJywgTm90ZXNDb250cm9sbGVyXSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBOb3Rlc0NvbnRyb2xsZXI7XG5cbn0pLmNhbGwodGhpcyk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW5vdGVzLWNvbnRyb2xsZXIuanMubWFwXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBNb2RhbENvbnRyb2xsZXIsIFByb2dyZXNzTW9kYWxDb250cm9sbGVyLFxuICAgIGV4dGVuZCA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoaGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfSxcbiAgICBoYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHk7XG5cbiAgTW9kYWxDb250cm9sbGVyID0gcmVxdWlyZSgnLi9tb2RhbC1jb250cm9sbGVyJyk7XG5cbiAgUHJvZ3Jlc3NNb2RhbENvbnRyb2xsZXIgPSAoZnVuY3Rpb24oc3VwZXJDbGFzcykge1xuICAgIGV4dGVuZChQcm9ncmVzc01vZGFsQ29udHJvbGxlciwgc3VwZXJDbGFzcyk7XG5cbiAgICBmdW5jdGlvbiBQcm9ncmVzc01vZGFsQ29udHJvbGxlcigkc2NvcGUsIHByb2dyZXNzKSB7XG4gICAgICB0aGlzLiRzY29wZSA9ICRzY29wZTtcbiAgICAgIHRoaXMucHJvZ3Jlc3MgPSBwcm9ncmVzcztcbiAgICAgIHRoaXMuJHNjb3BlLnByb2dyZXNzID0gdGhpcy5wcm9ncmVzcztcbiAgICB9XG5cbiAgICByZXR1cm4gUHJvZ3Jlc3NNb2RhbENvbnRyb2xsZXI7XG5cbiAgfSkoTW9kYWxDb250cm9sbGVyKTtcblxuICBhcHAuY29udHJvbGxlcignUHJvZ3Jlc3NNb2RhbENvbnRyb2xsZXInLCBbJyRzY29wZScsICdwcm9ncmVzcycsIFByb2dyZXNzTW9kYWxDb250cm9sbGVyXSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBQcm9ncmVzc01vZGFsQ29udHJvbGxlcjtcblxufSkuY2FsbCh0aGlzKTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvZ3Jlc3MtbW9kYWwtY29udHJvbGxlci5qcy5tYXBcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjNcbihmdW5jdGlvbigpIHtcbiAgdmFyIFNldHRpbmdzQ29udHJvbGxlcixcbiAgICBiaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfTtcblxuICBTZXR0aW5nc0NvbnRyb2xsZXIgPSAoZnVuY3Rpb24oKSB7XG4gICAgU2V0dGluZ3NDb250cm9sbGVyLnByb3RvdHlwZS5sYXN0UXVlcnlTdHIgPSBudWxsO1xuXG4gICAgZnVuY3Rpb24gU2V0dGluZ3NDb250cm9sbGVyKCRzY29wZSwgJGh0dHAsIG5vdGVGaWx0ZXIpIHtcbiAgICAgIHRoaXMuJHNjb3BlID0gJHNjb3BlO1xuICAgICAgdGhpcy4kaHR0cCA9ICRodHRwO1xuICAgICAgdGhpcy5ub3RlRmlsdGVyID0gbm90ZUZpbHRlcjtcbiAgICAgIHRoaXMuX29uV2F0Y2hOb3RlRmlsdGVyID0gYmluZCh0aGlzLl9vbldhdGNoTm90ZUZpbHRlciwgdGhpcyk7XG4gICAgICB0aGlzLiRzY29wZS5ub3RlRmlsdGVyID0gdGhpcy5ub3RlRmlsdGVyO1xuICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoR3JvdXAoWydub3RlRmlsdGVyLnVwZGF0ZWQnLCAnbm90ZUZpbHRlci5ub3RlYm9va3MnLCAnbm90ZUZpbHRlci5zdGFja3MnXSwgdGhpcy5fb25XYXRjaE5vdGVGaWx0ZXIpO1xuICAgIH1cblxuICAgIFNldHRpbmdzQ29udHJvbGxlci5wcm90b3R5cGUuX29uV2F0Y2hOb3RlRmlsdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcXVlcnksIHF1ZXJ5U3RyO1xuICAgICAgcXVlcnkgPSB0aGlzLm5vdGVGaWx0ZXIucXVlcnkoKTtcbiAgICAgIHF1ZXJ5U3RyID0gSlNPTi5zdHJpbmdpZnkocXVlcnkpO1xuICAgICAgaWYgKHRoaXMubGFzdFF1ZXJ5U3RyID09PSBxdWVyeVN0cikge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLmxhc3RRdWVyeVN0ciA9IHF1ZXJ5U3RyO1xuICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCcvbm90ZXMvY291bnQnLCB7XG4gICAgICAgIHBhcmFtczoge1xuICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxuICAgICAgICB9XG4gICAgICB9KS5zdWNjZXNzKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgIHJldHVybiBfdGhpcy5ub3RlRmlsdGVyLmNvdW50ID0gZGF0YTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKS5lcnJvcigoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICByZXR1cm4gX3RoaXMubm90ZUZpbHRlci5jb3VudCA9IG51bGw7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBTZXR0aW5nc0NvbnRyb2xsZXI7XG5cbiAgfSkoKTtcblxuICBhcHAuY29udHJvbGxlcignU2V0dGluZ3NDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnbm90ZUZpbHRlcicsIFNldHRpbmdzQ29udHJvbGxlcl0pO1xuXG4gIG1vZHVsZS5leHBvcnRzID0gU2V0dGluZ3NDb250cm9sbGVyO1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1zZXR0aW5ncy1jb250cm9sbGVyLmpzLm1hcFxuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuM1xuKGZ1bmN0aW9uKCkge1xuICB2YXIgVGltZWxpbmVDb250cm9sbGVyLFxuICAgIGJpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9O1xuXG4gIFRpbWVsaW5lQ29udHJvbGxlciA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBUaW1lbGluZUNvbnRyb2xsZXIoJHNjb3BlKSB7XG4gICAgICB2YXIgY29udGFpbmVyLCBvcHRpb25zO1xuICAgICAgdGhpcy4kc2NvcGUgPSAkc2NvcGU7XG4gICAgICB0aGlzLl9vblJlc2l6ZSA9IGJpbmQodGhpcy5fb25SZXNpemUsIHRoaXMpO1xuICAgICAgdGhpcy5fb25XYXRjaFByb2ZpdExvZ3MgPSBiaW5kKHRoaXMuX29uV2F0Y2hQcm9maXRMb2dzLCB0aGlzKTtcbiAgICAgIHRoaXMuX29uV2F0Y2hOb3RlcyA9IGJpbmQodGhpcy5fb25XYXRjaE5vdGVzLCB0aGlzKTtcbiAgICAgIHRoaXMuX29uV2F0Y2hQZXJzb25zID0gYmluZCh0aGlzLl9vbldhdGNoUGVyc29ucywgdGhpcyk7XG4gICAgICB0aGlzLiRzY29wZS50aW1lbGluZUl0ZW1zID0gbmV3IHZpcy5EYXRhU2V0KCk7XG4gICAgICB0aGlzLiRzY29wZS50aW1lbGluZUdyb3VwcyA9IG5ldyB2aXMuRGF0YVNldCgpO1xuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RpbWVsaW5lJyk7XG4gICAgICBvcHRpb25zID0ge1xuICAgICAgICBtYXJnaW46IHtcbiAgICAgICAgICBpdGVtOiA1XG4gICAgICAgIH0sXG4gICAgICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0IC0gODAsXG4gICAgICAgIG9yaWVudGF0aW9uOiB7XG4gICAgICAgICAgYXhpczogJ2JvdGgnLFxuICAgICAgICAgIGl0ZW06ICd0b3AnXG4gICAgICAgIH0sXG4gICAgICAgIHN0YXJ0OiBtb21lbnQoKS5zdGFydE9mKCdkYXknKSxcbiAgICAgICAgZW5kOiBtb21lbnQoKS5lbmRPZignZGF5JyksXG4gICAgICAgIGhpZGRlbkRhdGVzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3RhcnQ6IG1vbWVudCgpLnN1YnRyYWN0KDEsICdkYXlzJykuc3RhcnRPZignZGF5JykuaG91cigyMCksXG4gICAgICAgICAgICBlbmQ6IG1vbWVudCgpLnN0YXJ0T2YoJ2RheScpLmhvdXIoOCksXG4gICAgICAgICAgICByZXBlYXQ6ICdkYWlseSdcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIG9yZGVyOiBmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgcmV0dXJuIGEuc3RhcnQgLSBiLnN0YXJ0O1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgdGhpcy4kc2NvcGUudGltZWxpbmUgPSBuZXcgdmlzLlRpbWVsaW5lKGNvbnRhaW5lciwgdGhpcy4kc2NvcGUudGltZWxpbmVJdGVtcywgdGhpcy4kc2NvcGUudGltZWxpbmVHcm91cHMsIG9wdGlvbnMpO1xuICAgICAgdGhpcy4kc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigncGVyc29ucycsIHRoaXMuX29uV2F0Y2hQZXJzb25zKTtcbiAgICAgIHRoaXMuJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ25vdGVzJywgdGhpcy5fb25XYXRjaE5vdGVzKTtcbiAgICAgIHRoaXMuJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3RpbWVMb2dzJywgdGhpcy5fb25XYXRjaE5vdGVzKTtcbiAgICAgIHRoaXMuJHNjb3BlLiR3YXRjaENvbGxlY3Rpb24oJ3Byb2ZpdExvZ3MnLCB0aGlzLl9vbldhdGNoUHJvZml0TG9ncyk7XG4gICAgICB0aGlzLiRzY29wZS4kb24oJ3Jlc2l6ZTo6cmVzaXplJywgdGhpcy5fb25SZXNpemUpO1xuICAgIH1cblxuICAgIFRpbWVsaW5lQ29udHJvbGxlci5wcm90b3R5cGUuX29uV2F0Y2hQZXJzb25zID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIga2V5LCBwZXJzb24sIHJlZjtcbiAgICAgIHRoaXMuJHNjb3BlLnRpbWVsaW5lR3JvdXBzLmNsZWFyKCk7XG4gICAgICByZWYgPSB0aGlzLiRzY29wZS5wZXJzb25zO1xuICAgICAgZm9yIChrZXkgaW4gcmVmKSB7XG4gICAgICAgIHBlcnNvbiA9IHJlZltrZXldO1xuICAgICAgICB0aGlzLiRzY29wZS50aW1lbGluZUdyb3Vwcy5hZGQoe1xuICAgICAgICAgIGlkOiBrZXksXG4gICAgICAgICAgY29udGVudDogcGVyc29uXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuJHNjb3BlLnRpbWVsaW5lR3JvdXBzLmFkZCh7XG4gICAgICAgIGlkOiAndXBkYXRlZCcsXG4gICAgICAgIGNvbnRlbnQ6ICdVcGRhdGUnXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgVGltZWxpbmVDb250cm9sbGVyLnByb3RvdHlwZS5fb25XYXRjaE5vdGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZW5kLCBub3RlLCBub3RlR3VpZCwgbm90ZVRpbWVMb2csIHJlZiwgcmVmMSwgcmVzdWx0cywgc3RhcnQsIHRpbWVMb2csIHRpbWVMb2dzX2lkO1xuICAgICAgdGhpcy4kc2NvcGUudGltZWxpbmVJdGVtcy5jbGVhcigpO1xuICAgICAgcmVmID0gdGhpcy4kc2NvcGUubm90ZXM7XG4gICAgICBmb3IgKG5vdGVHdWlkIGluIHJlZikge1xuICAgICAgICBub3RlID0gcmVmW25vdGVHdWlkXTtcbiAgICAgICAgdGhpcy4kc2NvcGUudGltZWxpbmVJdGVtcy5hZGQoe1xuICAgICAgICAgIGlkOiBub3RlLmd1aWQsXG4gICAgICAgICAgZ3JvdXA6ICd1cGRhdGVkJyxcbiAgICAgICAgICBjb250ZW50OiBcIjxhIGhyZWY9XFxcImV2ZXJub3RlOi8vL3ZpZXcvXCIgKyB0aGlzLiRzY29wZS51c2VyLmlkICsgXCIvXCIgKyB0aGlzLiRzY29wZS51c2VyLnNoYXJkSWQgKyBcIi9cIiArIG5vdGUuZ3VpZCArIFwiL1wiICsgbm90ZS5ndWlkICsgXCIvXFxcIj5cIiArIG5vdGUudGl0bGUgKyBcIjwvYT5cIixcbiAgICAgICAgICBzdGFydDogbmV3IERhdGUobm90ZS51cGRhdGVkKSxcbiAgICAgICAgICB0eXBlOiAncG9pbnQnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmVmMSA9IHRoaXMuJHNjb3BlLnRpbWVMb2dzO1xuICAgICAgcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChub3RlR3VpZCBpbiByZWYxKSB7XG4gICAgICAgIG5vdGVUaW1lTG9nID0gcmVmMVtub3RlR3VpZF07XG4gICAgICAgIHJlc3VsdHMucHVzaCgoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdHMxO1xuICAgICAgICAgIHJlc3VsdHMxID0gW107XG4gICAgICAgICAgZm9yICh0aW1lTG9nc19pZCBpbiBub3RlVGltZUxvZykge1xuICAgICAgICAgICAgdGltZUxvZyA9IG5vdGVUaW1lTG9nW3RpbWVMb2dzX2lkXTtcbiAgICAgICAgICAgIHN0YXJ0ID0gbmV3IERhdGUodGltZUxvZy5kYXRlKTtcbiAgICAgICAgICAgIGlmICh0aW1lTG9nLnNwZW50VGltZSkge1xuICAgICAgICAgICAgICBlbmQgPSBuZXcgRGF0ZShzdGFydCk7XG4gICAgICAgICAgICAgIGVuZC5zZXRNaW51dGVzKHN0YXJ0LmdldE1pbnV0ZXMoKSArIHRpbWVMb2cuc3BlbnRUaW1lKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGVuZCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRzMS5wdXNoKHRoaXMuJHNjb3BlLnRpbWVsaW5lSXRlbXMuYWRkKHtcbiAgICAgICAgICAgICAgaWQ6IHRpbWVMb2cuX2lkLFxuICAgICAgICAgICAgICBncm91cDogdGltZUxvZy5wZXJzb24sXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IFwiPGEgaHJlZj1cXFwiZXZlcm5vdGU6Ly8vdmlldy9cIiArIHRoaXMuJHNjb3BlLnVzZXIuaWQgKyBcIi9cIiArIHRoaXMuJHNjb3BlLnVzZXIuc2hhcmRJZCArIFwiL1wiICsgdGltZUxvZy5ub3RlR3VpZCArIFwiL1wiICsgdGltZUxvZy5ub3RlR3VpZCArIFwiL1xcXCI+XCIgKyB0aGlzLiRzY29wZS5ub3Rlc1t0aW1lTG9nLm5vdGVHdWlkXS50aXRsZSArIFwiIFwiICsgdGltZUxvZy5jb21tZW50ICsgXCI8L2E+XCIsXG4gICAgICAgICAgICAgIHN0YXJ0OiBzdGFydCxcbiAgICAgICAgICAgICAgZW5kOiBlbmQsXG4gICAgICAgICAgICAgIHR5cGU6IGVuZCA/ICdyYW5nZScgOiAncG9pbnQnXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHRzMTtcbiAgICAgICAgfSkuY2FsbCh0aGlzKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9O1xuXG4gICAgVGltZWxpbmVDb250cm9sbGVyLnByb3RvdHlwZS5fb25XYXRjaFByb2ZpdExvZ3MgPSBmdW5jdGlvbigpIHt9O1xuXG4gICAgVGltZWxpbmVDb250cm9sbGVyLnByb3RvdHlwZS5fb25SZXNpemUgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuJHNjb3BlLnRpbWVsaW5lLnNldE9wdGlvbnMoe1xuICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCAtIDkwXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFRpbWVsaW5lQ29udHJvbGxlcjtcblxuICB9KSgpO1xuXG4gIGFwcC5jb250cm9sbGVyKCdUaW1lbGluZUNvbnRyb2xsZXInLCBbJyRzY29wZScsIFRpbWVsaW5lQ29udHJvbGxlcl0pO1xuXG4gIG1vZHVsZS5leHBvcnRzID0gVGltZWxpbmVDb250cm9sbGVyO1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD10aW1lbGluZS1jb250cm9sbGVyLmpzLm1hcFxuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuM1xuKGZ1bmN0aW9uKCkge1xuICBhcHAuZGlyZWN0aXZlKCdyZXNpemUnLCBmdW5jdGlvbigkdGltZW91dCwgJHJvb3RTY29wZSwgJHdpbmRvdykge1xuICAgIHJldHVybiB7XG4gICAgICBsaW5rOiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHRpbWVyO1xuICAgICAgICB0aW1lciA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpLm9uKCdsb2FkIHJlc2l6ZScsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHRpbWVyKSB7XG4gICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3Jlc2l6ZTo6cmVzaXplJyk7XG4gICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSk7XG5cbn0pLmNhbGwodGhpcyk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXJlc2l6ZS5qcy5tYXBcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjNcclxuKGZ1bmN0aW9uKCkge1xyXG4gIHZhciBjaGVja0l0ZW1NYXRjaGVzLCBmaWx0ZXJCeVByb3BlcnR5O1xyXG5cclxuICBjaGVja0l0ZW1NYXRjaGVzID0gKGZ1bmN0aW9uKF90aGlzKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oaXRlbSwgcHJvcHMpIHtcclxuICAgICAgdmFyIGl0ZW1NYXRjaGVzLCBwcm9wLCB0ZXh0O1xyXG4gICAgICBpdGVtTWF0Y2hlcyA9IGZhbHNlO1xyXG4gICAgICBmb3IgKHByb3AgaW4gcHJvcHMpIHtcclxuICAgICAgICB0ZXh0ID0gcHJvcHNbcHJvcF07XHJcbiAgICAgICAgdGV4dCA9IHRleHQudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAoaXRlbVtwcm9wXS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZih0ZXh0KSAhPT0gLTEpIHtcclxuICAgICAgICAgIGl0ZW1NYXRjaGVzID0gdHJ1ZTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gaXRlbU1hdGNoZXM7XHJcbiAgICB9O1xyXG4gIH0pKHRoaXMpO1xyXG5cclxuICBmaWx0ZXJCeVByb3BlcnR5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24oaXRlbXMsIHByb3BzKSB7XHJcbiAgICAgIHZhciBpLCBpdGVtLCBpdGVtTWF0Y2hlcywga2V5LCBsZW4sIG91dDtcclxuICAgICAgb3V0ID0gW107XHJcbiAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoaXRlbXMpKSB7XHJcbiAgICAgICAgZm9yIChpID0gMCwgbGVuID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgIGl0ZW0gPSBpdGVtc1tpXTtcclxuICAgICAgICAgIGl0ZW1NYXRjaGVzID0gY2hlY2tJdGVtTWF0Y2hlcyhpdGVtLCBwcm9wcyk7XHJcbiAgICAgICAgICBpZiAoaXRlbU1hdGNoZXMpIHtcclxuICAgICAgICAgICAgb3V0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNPYmplY3QoaXRlbXMpKSB7XHJcbiAgICAgICAgZm9yIChrZXkgaW4gaXRlbXMpIHtcclxuICAgICAgICAgIGl0ZW0gPSBpdGVtc1trZXldO1xyXG4gICAgICAgICAgaXRlbU1hdGNoZXMgPSBjaGVja0l0ZW1NYXRjaGVzKGl0ZW0sIHByb3BzKTtcclxuICAgICAgICAgIGlmIChpdGVtTWF0Y2hlcykge1xyXG4gICAgICAgICAgICBvdXQucHVzaChpdGVtKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb3V0ID0gaXRlbXM7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG91dDtcclxuICAgIH07XHJcbiAgfTtcclxuXHJcbiAgYXBwLmZpbHRlcignZmlsdGVyQnlQcm9wZXJ0eScsIGZpbHRlckJ5UHJvcGVydHkpO1xyXG5cclxuICBtb2R1bGUuZXhwb3J0cyA9IGZpbHRlckJ5UHJvcGVydHk7XHJcblxyXG59KS5jYWxsKHRoaXMpO1xyXG5cclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmlsdGVyLWJ5LXByb3BlcnR5LmpzLm1hcFxyXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4zXHJcbihmdW5jdGlvbigpIHtcclxuICB2YXIgb3JkZXJPYmplY3RCeTtcclxuXHJcbiAgb3JkZXJPYmplY3RCeSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW1zLCBmaWVsZCwgcmV2ZXJzZSkge1xyXG4gICAgICB2YXIgZmlsdGVyZWQsIHJlc3VsdHM7XHJcbiAgICAgIGlmIChmaWVsZCA9PSBudWxsKSB7XHJcbiAgICAgICAgZmllbGQgPSAnJHZhbHVlJztcclxuICAgICAgfVxyXG4gICAgICBpZiAocmV2ZXJzZSA9PSBudWxsKSB7XHJcbiAgICAgICAgcmV2ZXJzZSA9IHRydWU7XHJcbiAgICAgIH1cclxuICAgICAgZmlsdGVyZWQgPSBbXTtcclxuICAgICAgYW5ndWxhci5mb3JFYWNoKGl0ZW1zLCBmdW5jdGlvbihpdGVtLCBrZXkpIHtcclxuICAgICAgICByZXR1cm4gZmlsdGVyZWQucHVzaCh7XHJcbiAgICAgICAgICBrZXk6IGtleSxcclxuICAgICAgICAgIGl0ZW06IGl0ZW1cclxuICAgICAgICB9KTtcclxuICAgICAgfSk7XHJcbiAgICAgIGZpbHRlcmVkLnNvcnQoZnVuY3Rpb24oYSwgYikge1xyXG4gICAgICAgIGlmIChmaWVsZCA9PT0gJyRrZXknKSB7XHJcbiAgICAgICAgICBpZiAoYS5rZXkgPiBiLmtleSkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZpZWxkID09PSAnJHZhbHVlJykge1xyXG4gICAgICAgICAgaWYgKGEuaXRlbSA+IGIuaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBmaWVsZCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgIGlmIChhW2ZpZWxkXSA+IGJbZmllbGRdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGZpZWxkID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICBpZiAoZmllbGQoYS5pdGVtLCBhLmtleSkgPiBmaWVsZChiLml0ZW0sIGIua2V5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAocmV2ZXJzZSkge1xyXG4gICAgICAgIGZpbHRlcmVkLnJldmVyc2UoKTtcclxuICAgICAgfVxyXG4gICAgICByZXN1bHRzID0gW107XHJcbiAgICAgIGFuZ3VsYXIuZm9yRWFjaChmaWx0ZXJlZCwgZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgcmVzdWx0ID0gaXRlbS5pdGVtO1xyXG4gICAgICAgIHJlc3VsdFsnJGtleSddID0gaXRlbS5rZXk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdHMucHVzaChyZXN1bHQpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIHJlc3VsdHM7XHJcbiAgICB9O1xyXG4gIH07XHJcblxyXG4gIGFwcC5maWx0ZXIoJ29yZGVyT2JqZWN0QnknLCBvcmRlck9iamVjdEJ5KTtcclxuXHJcbiAgbW9kdWxlLmV4cG9ydHMgPSBvcmRlck9iamVjdEJ5O1xyXG5cclxufSkuY2FsbCh0aGlzKTtcclxuXHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPW9yZGVyLW9iamVjdC1ieS5qcy5tYXBcclxuIiwiIyBhbmd1bGFyLmpzIHNldHRpbmdcclxud2luZG93LmFwcCA9IGFuZ3VsYXIubW9kdWxlKCdBcHAnLCBbJ25nUm91dGUnLCAndWkuYm9vdHN0cmFwJywgJ25nU2FuaXRpemUnLCAndWkuc2VsZWN0J10pXHJcblxyXG5hcHAuY29uZmlnIFsnJGNvbXBpbGVQcm92aWRlcicsICgkY29tcGlsZVByb3ZpZGVyKSAtPlxyXG4gICRjb21waWxlUHJvdmlkZXIuYUhyZWZTYW5pdGl6YXRpb25XaGl0ZWxpc3QoL15cXHMqKGh0dHB8aHR0cHN8bWFpbHRvfGV2ZXJub3RlKTovKTtcclxuXVxyXG5cclxuIyByb3V0ZSBzZXR0aW5nc1xyXG5yZXF1aXJlICcuL3JvdXRlJ1xyXG5cclxuIyBhbmd1bGFyLmpzIGZpbHRlcnNcclxucmVxdWlyZSAnLi9maWx0ZXJzL2ZpbHRlci1ieS1wcm9wZXJ0eSdcclxucmVxdWlyZSAnLi9maWx0ZXJzL29yZGVyLW9iamVjdC1ieSdcclxuXHJcbiMgYW5ndWxhci5qcyBzZXJ2aWNlc1xyXG5yZXF1aXJlICcuL3NlcnZpY2VzL25vdGUtZmlsdGVyJ1xyXG5yZXF1aXJlICcuL3NlcnZpY2VzL3Byb2dyZXNzJ1xyXG5cclxuIyBhbmd1bGFyLmpzIGRpcmVjdGl2ZXNcclxucmVxdWlyZSAnLi9kaXJlY3RpdmVzL3Jlc2l6ZSdcclxuXHJcbiMgYW5ndWxhci5qcyBjb250cm9sbGVyc1xyXG5yZXF1aXJlICcuL2NvbnRyb2xsZXJzL2NvbnRyb2xsZXInXHJcbnJlcXVpcmUgJy4vY29udHJvbGxlcnMvbmF2aWdhdGlvbi1jb250cm9sbGVyJ1xyXG5yZXF1aXJlICcuL2NvbnRyb2xsZXJzL3RpbWVsaW5lLWNvbnRyb2xsZXInXHJcbnJlcXVpcmUgJy4vY29udHJvbGxlcnMvbm90ZXMtY29udHJvbGxlcidcclxucmVxdWlyZSAnLi9jb250cm9sbGVycy9zZXR0aW5ncy1jb250cm9sbGVyJ1xyXG5yZXF1aXJlICcuL2NvbnRyb2xsZXJzL3Byb2dyZXNzLW1vZGFsLWNvbnRyb2xsZXInXHJcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjNcbihmdW5jdGlvbigpIHtcbiAgYXBwLmNvbmZpZyhbXG4gICAgJyRyb3V0ZVByb3ZpZGVyJywgZnVuY3Rpb24oJHJvdXRlUHJvdmlkZXIpIHtcbiAgICAgIHJldHVybiAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xuICAgICAgICByZWRpcmVjdFRvOiAnL3RpbWVsaW5lJ1xuICAgICAgfSkud2hlbignL3RpbWVsaW5lJywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RpbWVsaW5lJ1xuICAgICAgfSkud2hlbignL25vdGVzJywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ25vdGVzJ1xuICAgICAgfSkud2hlbignL3NldHRpbmdzJywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ3NldHRpbmdzJ1xuICAgICAgfSkub3RoZXJ3aXNlKHtcbiAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICB9KTtcbiAgICB9XG4gIF0pO1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1yb3V0ZS5qcy5tYXBcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjNcbihmdW5jdGlvbigpIHtcbiAgdmFyIE5vdGVGaWx0ZXJTZXJ2aWNlLFxuICAgIGJpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9O1xuXG4gIE5vdGVGaWx0ZXJTZXJ2aWNlID0gKGZ1bmN0aW9uKCkge1xuICAgIE5vdGVGaWx0ZXJTZXJ2aWNlLnByb3RvdHlwZS51cGRhdGVkID0gMztcblxuICAgIE5vdGVGaWx0ZXJTZXJ2aWNlLnByb3RvdHlwZS5ub3RlYm9va3MgPSBudWxsO1xuXG4gICAgTm90ZUZpbHRlclNlcnZpY2UucHJvdG90eXBlLnN0YWNrcyA9IG51bGw7XG5cbiAgICBOb3RlRmlsdGVyU2VydmljZS5wcm90b3R5cGUuY291bnQgPSBudWxsO1xuXG4gICAgZnVuY3Rpb24gTm90ZUZpbHRlclNlcnZpY2UoJHJvb3RTY29wZSkge1xuICAgICAgdGhpcy4kcm9vdFNjb3BlID0gJHJvb3RTY29wZTtcbiAgICAgIHRoaXMucXVlcnkgPSBiaW5kKHRoaXMucXVlcnksIHRoaXMpO1xuICAgIH1cblxuICAgIE5vdGVGaWx0ZXJTZXJ2aWNlLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGksIGosIGxlbiwgbGVuMSwgbm90ZWJvb2ssIG5vdGVib29rR3VpZCwgbm90ZWJvb2tzQXJyYXksIG5vdGVib29rc0hhc2gsIHJlZiwgcmVmMSwgcmVmMiwgcmVzdWx0LCBzdGFjaztcbiAgICAgIHJlc3VsdCA9IHt9O1xuICAgICAgaWYgKHRoaXMudXBkYXRlZCkge1xuICAgICAgICBtZXJnZShyZXN1bHQsIHtcbiAgICAgICAgICB1cGRhdGVkOiB7XG4gICAgICAgICAgICAkZ3RlOiBwYXJzZUludChtb21lbnQoKS5zdGFydE9mKCdkYXknKS5zdWJ0cmFjdCh0aGlzLnVwZGF0ZWQsICdkYXlzJykuZm9ybWF0KCd4JykpXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIG5vdGVib29rc0hhc2ggPSB7fTtcbiAgICAgIGlmICh0aGlzLm5vdGVib29rcyAmJiB0aGlzLm5vdGVib29rcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlZiA9IHRoaXMubm90ZWJvb2tzO1xuICAgICAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBub3RlYm9va0d1aWQgPSByZWZbaV07XG4gICAgICAgICAgbm90ZWJvb2tzSGFzaFtub3RlYm9va0d1aWRdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHRoaXMuc3RhY2tzICYmIHRoaXMuc3RhY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVmMSA9IHRoaXMuc3RhY2tzO1xuICAgICAgICBmb3IgKGogPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGogPCBsZW4xOyBqKyspIHtcbiAgICAgICAgICBzdGFjayA9IHJlZjFbal07XG4gICAgICAgICAgcmVmMiA9IHRoaXMuJHJvb3RTY29wZS5ub3RlYm9va3M7XG4gICAgICAgICAgZm9yIChub3RlYm9va0d1aWQgaW4gcmVmMikge1xuICAgICAgICAgICAgbm90ZWJvb2sgPSByZWYyW25vdGVib29rR3VpZF07XG4gICAgICAgICAgICBpZiAoc3RhY2sgPT09IG5vdGVib29rLnN0YWNrKSB7XG4gICAgICAgICAgICAgIG5vdGVib29rc0hhc2hbbm90ZWJvb2suZ3VpZF0gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbm90ZWJvb2tzQXJyYXkgPSBPYmplY3Qua2V5cyhub3RlYm9va3NIYXNoKTtcbiAgICAgIGlmIChub3RlYm9va3NBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICAgIG1lcmdlKHJlc3VsdCwge1xuICAgICAgICAgIG5vdGVib29rR3VpZDoge1xuICAgICAgICAgICAgJGluOiBub3RlYm9va3NBcnJheVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG5cbiAgICByZXR1cm4gTm90ZUZpbHRlclNlcnZpY2U7XG5cbiAgfSkoKTtcblxuICBhcHAuc2VydmljZSgnbm90ZUZpbHRlcicsIFsnJHJvb3RTY29wZScsIE5vdGVGaWx0ZXJTZXJ2aWNlXSk7XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBOb3RlRmlsdGVyU2VydmljZTtcblxufSkuY2FsbCh0aGlzKTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bm90ZS1maWx0ZXIuanMubWFwXG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuOS4zXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBQcm9ncmVzc1NlcnZpY2UsXG4gICAgYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH07XG5cbiAgUHJvZ3Jlc3NTZXJ2aWNlID0gKGZ1bmN0aW9uKCkge1xuICAgIFByb2dyZXNzU2VydmljZS5wcm90b3R5cGUubW9kYWxJbnN0YW5jZSA9IG51bGw7XG5cbiAgICBQcm9ncmVzc1NlcnZpY2UucHJvdG90eXBlLnZhbHVlID0gMDtcblxuICAgIFByb2dyZXNzU2VydmljZS5wcm90b3R5cGUubWVzc2FnZSA9ICcnO1xuXG4gICAgZnVuY3Rpb24gUHJvZ3Jlc3NTZXJ2aWNlKCRtb2RhbCkge1xuICAgICAgdGhpcy4kbW9kYWwgPSAkbW9kYWw7XG4gICAgICB0aGlzLnNldCA9IGJpbmQodGhpcy5zZXQsIHRoaXMpO1xuICAgICAgdGhpcy5jbG9zZSA9IGJpbmQodGhpcy5jbG9zZSwgdGhpcyk7XG4gICAgICB0aGlzLm9wZW4gPSBiaW5kKHRoaXMub3BlbiwgdGhpcyk7XG4gICAgfVxuXG4gICAgUHJvZ3Jlc3NTZXJ2aWNlLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm1lc3NhZ2UgPSAncHJvY2Vzc2luZy4uLic7XG4gICAgICB0aGlzLnZhbHVlID0gMDtcbiAgICAgIHJldHVybiB0aGlzLm1vZGFsSW5zdGFuY2UgPSB0aGlzLiRtb2RhbC5vcGVuKHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdwcm9ncmVzcy1tb2RhbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdQcm9ncmVzc01vZGFsQ29udHJvbGxlcicsXG4gICAgICAgIGJhY2tkcm9wOiAnc3RhdGljJyxcbiAgICAgICAga2V5Ym9hcmQ6IGZhbHNlLFxuICAgICAgICBzaXplOiAnc20nLFxuICAgICAgICBhbmltYXRpb246IGZhbHNlXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgUHJvZ3Jlc3NTZXJ2aWNlLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMubW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgIH07XG5cbiAgICBQcm9ncmVzc1NlcnZpY2UucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICB2YWx1ZSA9IG51bGw7XG4gICAgICB9XG4gICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgaWYgKHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBQcm9ncmVzc1NlcnZpY2U7XG5cbiAgfSkoKTtcblxuICBhcHAuc2VydmljZSgncHJvZ3Jlc3MnLCBbJyRtb2RhbCcsIFByb2dyZXNzU2VydmljZV0pO1xuXG4gIG1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NTZXJ2aWNlO1xuXG59KS5jYWxsKHRoaXMpO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wcm9ncmVzcy5qcy5tYXBcbiJdfQ==
